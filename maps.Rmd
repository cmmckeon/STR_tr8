---
title: "maps"
author: "Caroline McKeon"
date: "3/7/2021"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sjPlot)
library(rnaturalearth)
library(sp)
library(sf)
library(raster)
library(viridis)
library(fasterize)
# blank theme
set_theme(
  base = theme_classic(),
  axis.title.size = 2,
  axis.textsize = 1.2,
  legend.size = 2,
  legend.title.size = 2,
  geom.label.size = 3,
  plot.margin = margin(3, 5, 1, 5, "pt")
)
pal <- colorRampPalette(c('#0C276C', '#3B9088', '#EEFF00', '#ffffff'))

knitr::opts_chunk$set(fig.width=30, fig.height=20) 
```

## read in data
```{r}
world <- ne_countries(scale = "medium", returnclass = "sf")
Europe <- world[which(world$continent == "Europe"),]

e <- Europe$geometry
e = st_as_sf(e)
e <- st_transform(e,"+proj=laea +lat_0=53 +lon_0=9 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ")

## current climate
clim_map <- readRDS("Data_1km_EU_clim_map.rds")
## past climate data
vel <- readRDS("Data_1km_EU_vel.rds")
## human footprint
hf <- readRDS("Data_1km_EU_hf.rds")

vals <- readRDS("Data_hf_vel_clim_map_values.rds")
gc()

```

## handle data
```{r}
h <- projectRaster(hf, crs = crs(e))
m <- mask(h, e)
```


```{r}
par(bg = "transparent")
plot(e, col='light gray', border='gray')
plot(m, add=TRUE, ext = extent(e), col = pal(50))
```

```{r}
v <- projectRaster(vel, crs = crs(e))
vm <- mask(v, e)
```


```{r}
par(bg = "transparent")
plot(e, col='light gray', border='gray')
plot(vm, add=TRUE, ext = extent(e))
```


```{r}
# ggplot(data = world) +
#     geom_sf(fill="lightgrey", colour="lightgrey") +
#     coord_sf(crs = "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80  +units=m +no_defs")



ggplot(data = Europe, aes(fill="grey", colour="grey")) +
    geom_sf(fill="lightgrey", colour="grey") +
  geom_point(data=h, aes(x=x, y=y, color = layer)) + 
    coord_sf(crs = "+proj=laea +lat_0=53 +lon_0=9 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs") +
  theme_void() 
 # geom_raster(data = hf, aes(x = x, y = y)) 
 # geom_tile(data = rast_df, mapping = aes(x = x, y = y)) 

   

# geom_point(data=j[j$layer==2,], aes(x=x, y=y), size=0.1, colour="blue")+
 #  geom_point(data=j[j$layer == 3,], aes(x=x, y=y), size=0.1, colour="yellow")

```



```{r}
# test_spdf <- as(hf, "SpatialPixelsDataFrame")
# test_df <- as.data.frame(test_spdf)
# colnames(test_df) <- c("value", "x", "y")
# 
# ggplot() +  
#   geom_tile(data=test_df, aes(x=x, y=y, fill=value), alpha=0.8) + 
#   geom_polygon(data=OR, aes(x=long, y=lat, group=group), 
#                fill=NA, color="grey50", size=0.25) +
#   scale_fill_viridis() +
#   coord_equal() +
#   theme_map() +
#   theme(legend.position="bottom") +
#   theme(legend.key.width=unit(2, "cm"))
```










