---
title: "08c_str_humanfootprint_results"
author: "Caroline McKeon"
date: "7/15/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


read in models
```{r}
m_metric_hf <- readRDS("m_metric_hf.rds")
m_metric_clim <- readRDS("m_metric_clim.rds")
m_metric_clim_hf <- readRDS("m_metric_clim_hf.rds")
```


```{r plotting themes}
# blank theme
set_theme(
  base = theme_classic(),
  axis.title.size = 2,
  axis.textsize = 1.2,
  legend.size = 2,
  legend.title.size = 2,
  geom.label.size = 3,
  plot.margin = margin(3, 5, 1, 5, "pt")
)

## text editing
get_wraper <- function(width) {
  function(x) {
    lapply(strwrap(x, width = width, simplify = FALSE), paste, collapse="\n")}}
## colour palett
cb_pal <- c("#01665e", "#5ab4ac","#c7eae5", "#d8b365", 
            "#8c510a")

r <- c("total.area", "range.size", "effective.mesh.size", "prop.landscape", "mean.shape.index", "perimeter.area.frac.dim")

```


DIC table
```{r}
l <- data.frame(cbind(r, c(1:6), c(1:6), c(1:6)))
l[,2] <- as.character(l[,2])
l[,3] <- as.character(l[,3])
l[,4] <- as.character(l[,4])
for(i in r){
  l[,2][l$r == i] <- round(m_metric_clim[[i]][["hf"]][[1]][["DIC"]],2)
  l[,3][l$r == i] <- round(m_metric_hf[[i]][["hf"]][[1]][["DIC"]],2)
  l[,4][l$r == i] <- round(m_metric_clim_hf[[i]][["hf"]][[1]][["DIC"]],2)
}
names(l) <- c("Metrics", "Climate", "Human_footprint", "Climate*Human_footprint")
```

```{r}
#https://haozhu233.github.io/kableExtra/awesome_table_in_html.html for colour by cell value
library(knitr)
library(kableExtra)
library(tidyverse)
dic_table <- as_tibble(l)

dic_table  %>%
  kable(booktabs = T) %>%
  kable_styling(bootstrap_options = "striped", full_width = F)
# add_header_above(
#   dic_table,
#   header = c("", "DIC comparison" =2), bold = TRUE, color = "black")
```

  


```{r}
par(mfrow = c(6,2), mar=c(4.5,4.5,2,2), col="black", col.main = "black", col.lab = "black")
k <- list("total area", " range size", " effective mesh size", "proportion of landscape", "mean shape index",
          "perimeter area fractality")
names(k) <- r

## climate
rr <- c()
c <- tibble("a", "b")
for(i in r) {
        sum <- as.data.frame(summary(m_metric_clim[[i]][["hf"]][[1]][["Sol"]])[["statistics"]]); 
        c <- rbind(c, c(sum$Mean[1], sum$Mean[2])); 
        rr <- append(rr, paste(i))}
c <- cbind(c[-1,], rr)

for(i in names(comp_data$data[which(names(comp_data$data) %in% c("total.area", "range.size", "effective.mesh.size","prop.landscape",  "mean.shape.index",  "perimeter.area.frac.dim"))])) {
        plot(f[[i]], data = comp_data$data, col = "grey", cex = 0.7, cex.lab = 1.5, cex.main = 1.8,
             ylab = paste(k[[i]]), main = paste(k[[i]]), xlab = paste("mean hf"), bty = "n")
        abline(c[,1][c$rr ==i], c[,2][c$rr ==i], col = "black", lwd = 6)
}

## hf
rr <- c()
c <- tibble("a", "b")
for(i in r) {
        sum <- as.data.frame(summary(m_metric_hf[[i]][["hf"]][[1]][["Sol"]])[["statistics"]]); 
        c <- rbind(c, c(sum$Mean[1], sum$Mean[2])); 
        rr <- append(rr, paste(i))}
c <- cbind(c[-1,], rr)

for(i in names(comp_data$data[which(names(comp_data$data) %in% c("total.area", "range.size", "effective.mesh.size","prop.landscape",  "mean.shape.index",  "perimeter.area.frac.dim"))])) {
        plot(f[[i]], data = comp_data$data, col = "grey", cex = 0.7, cex.lab = 1.5, cex.main = 1.8,
             ylab = paste(k[[i]]), main = paste(k[[i]]), xlab = paste("mean hf"), bty = "n")
        abline(c[,1][c$rr ==i], c[,2][c$rr ==i], col = "black", lwd = 6)
}

## climate and hf
# rr <- c()
# c <- tibble("a", "b")
# for(i in r) {
#         sum <- as.data.frame(summary(m_metric_clim_hf[[i]][["hf"]][[1]][["Sol"]])[["statistics"]]); 
#         c <- rbind(c, c(sum$Mean[1], sum$Mean[2])); 
#         rr <- append(rr, paste(i))}
# c <- cbind(c[-1,], rr)
# 
# for(i in names(comp_data$data[which(names(comp_data$data) %in% c("total.area", "range.size", "effective.mesh.size","prop.landscape",  "mean.shape.index",  "perimeter.area.frac.dim"))])) {
#         plot(f[[i]], data = comp_data$data, col = "grey", cex = 0.7, cex.lab = 1.5, cex.main = 1.8,
#              ylab = paste(k[[i]]), main = paste(k[[i]]), xlab = paste("mean hf"), bty = "n")
#         abline(c[,1][c$rr ==i], c[,2][c$rr ==i], col = "black", lwd = 6)
# }
```

```{r}
sum <- list()
for(i in r) {
sum[[i]] <- as.data.frame(summary(m_metric_clim_hf[[i]][["hf"]][[1]][["Sol"]])[["statistics"]]);
sum[[i]] <- setDT(sum[[i]], keep.rownames = TRUE)[]
}
#sum[[i]]$ci <- sum[[i]]$'Naive SE'*qnorm(.95)
```

```{r}
par(mfrow = c(6,1), mar=c(4.5,4.5,2,2), col="black", col.main = "black", col.lab = "black")
p <- list()
for(i in r){
  print(ggplot(sum[[i]][2:6,],  aes(rn, Mean)) + 
  geom_pointrange(data = sum[[i]][2:6,],
                    aes(rn, Mean, ymin= Mean - SD, ymax= Mean + SD), 
                    position = position_dodge(0.5), size = 1.5) +
  
    theme(axis.title.x = element_blank(), title = element_blank(),
         axis.line = element_line(colour = 'black', size = 1.5)) +
   theme(axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
  scale_x_discrete(labels = get_wraper(10)) +
  labs(colour = "Life form", title = paste(i)) +
  scale_color_viridis(discrete = TRUE) +
    ylim(-1, 1)) }
```


```{r}

p[[1]]
p[[2]]
p[[3]]
p[[4]]
p[[5]]
p[[6]]
```

































